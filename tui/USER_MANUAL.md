# TUI 用户使用手册

欢迎使用音乐分离训练 TUI（终端用户界面）！本手册将帮助你快速上手使用这个工具。

## 目录

1. [快速开始](#快速开始)
2. [基本操作](#基本操作)
3. [功能说明](#功能说明)
4. [常见问题](#常见问题)
5. [键盘快捷键](#键盘快捷键)

---

## 快速开始

### 第一步：启动程序

双击 `mss_tui.exe` 文件，或者在命令行中运行：

```bash
./mss_tui.exe
```

### 第二步：选择模型

程序启动后，你会看到主菜单。使用 **上下方向键** 选择 "1. Model Selection"，然后按 **Enter** 键。

### 第三步：选择要使用的模型

在模型选择界面，使用 **上下方向键** 浏览可用的模型，按 **Enter** 选择你想要的模型。

### 第四步：开始使用

选择模型后，你可以开始训练、推理或验证操作。

---

## 基本操作

### 导航菜单

```
┌─────────────────────────────────────┐
│  Music Source Separation TUI    │
├─────────────────────────────────────┤
│  1. Model Selection           │
│  2. Configuration            │
│  3. Training                │
│  4. Inference               │
│  5. Validation              │
│  q. Quit                   │
│  h. Help                   │
└─────────────────────────────────────┘
```

**黄色高亮**的项目表示当前选中的项目。

### 选择项目

1. 使用 **↑** 和 **↓** 方向键移动光标
2. 光标会以**黄色粗体**显示
3. 按 **Enter** 键确认选择

### 返回上一级

在任何界面按 **Esc** 键可以返回上一级菜单。

### 获取帮助

按 **h** 键可以查看帮助信息，按任意键关闭帮助。

### 退出程序

在主菜单按 **q** 键或 **Esc** 键可以退出程序。

---

## 功能说明

### 1. 模型选择 (Model Selection)

支持 16 种音乐分离模型：

| 序号 | 模型名称 | 描述 |
|-----|---------|------|
| 1 | MDX23C | KUIELab TFC TDF v3 架构 |
| 2 | Demucs4HT | 混合 transformer 架构 |
| 3 | VitLarge23 | 基于 vision transformer |
| 4 | TorchSeg | 800+ 编码器的分割模型 |
| 5 | Band Split RoFormer | 带旋转注意力和频带分割 |
| 6 | Mel-Band RoFormer | Mel 频谱图频带分割 |
| 7 | Swin Upernet | Swin transformer + UperNet |
| 8 | BandIt Plus | 频带限制注意力 |
| 9 | SCNet | 频谱卷积网络 |
| 10 | BandIt v2 | 改进的频带限制注意力 |
| 11 | Apollo | 高级分离架构 |
| 12 | TS BSMamba2 | 状态空间模型 |
| 13 | Conformer | 卷积增强 transformer |
| 14 | BS Conformer | 频带分割 conformer |
| 15 | SCNet Tran | Transformer 变体 |
| 16 | SCNet Masked | 掩码变体 |

**如何使用**：
1. 在主菜单选择 "1. Model Selection"
2. 使用方向键浏览模型
3. 按 Enter 选择你想要的模型
4. 按 Esc 返回主菜单

### 2. 配置管理 (Configuration)

管理训练和推理的配置文件。

**功能**：
- 编辑 YAML 配置文件
- 加载和保存配置
- 管理多个配置方案

**注意**：此功能正在开发中，敬请期待！

### 3. 训练 (Training)

使用选定的模型训练音乐分离模型。

**功能**：
- 实时监控训练进度
- 显示损失曲线
- 显示验证指标（SDR、SIR、SAR、ISR）
- 支持多 GPU 训练
- 支持检查点保存和恢复

**如何使用**：
1. 先在 "Model Selection" 中选择模型
2. 在主菜单选择 "3. Training"
3. 配置训练参数（数据路径、验证路径等）
4. 开始训练并监控进度

**注意**：此功能正在开发中，敬请期待！

### 4. 推理 (Inference)

使用训练好的模型对音频文件进行分离。

**功能**：
- 批量处理音频文件
- 支持多种音频格式
- 实时显示推理进度
- 自动保存分离结果

**如何使用**：
1. 先在 "Model Selection" 中选择模型
2. 在主菜单选择 "4. Inference"
3. 选择输入音频文件夹
4. 选择输出文件夹
5. 开始推理

**注意**：此功能正在开发中，敬请期待！

### 5. 验证 (Validation)

评估模型在测试集上的性能。

**功能**：
- 计算分离质量指标
- 显示 SDR（信号失真比）
- 显示 SIR（信号干扰比）
- 显示 SAR（空间错误比）
- 显示 ISR（图像空间比）

**如何使用**：
1. 先在 "Model Selection" 中选择模型
2. 在主菜单选择 "5. Validation"
3. 选择验证数据集
4. 开始验证并查看结果

**注意**：此功能正在开发中，敬请期待！

---

## 键盘快捷键

| 按键 | 功能 | 说明 |
|-----|------|------|
| **↑** | 向上移动 | 在列表中向上移动光标 |
| **↓** | 向下移动 | 在列表中向下移动光标 |
| **Enter** | 确认选择 | 选择当前高亮的项目 |
| **Esc** | 返回 | 返回上一级菜单或退出 |
| **h** | 帮助 | 显示帮助信息 |
| **q** | 退出 | 退出程序（仅在主菜单） |

---

## 常见问题

### Q1: 程序启动后显示乱码或字符错位

**A**: 这通常是因为终端窗口太小。请尝试：
1. 最大化终端窗口
2. 确保终端窗口至少 80x24 字符
3. 在 Windows 上使用 PowerShell 或 CMD

### Q2: 按方向键没有反应

**A**: 请检查：
1. 确保终端窗口是活动窗口
2. 尝试重新启动程序
3. 如果使用远程终端，确保支持方向键

### Q3: 程序卡住了，无法操作

**A**: 
1. 按 **Esc** 键返回上一级
2. 如果帮助界面显示，按任意键关闭
3. 如果仍然卡住，按 **Ctrl+C** 强制退出

### Q4: 如何知道当前选中的是哪个项目？

**A**: 当前选中的项目会以**黄色粗体**显示，其他项目为白色。

```
普通项目（白色）:
  1. Model Selection

选中项目（黄色粗体）:
  2. Configuration
```

### Q5: 我可以在哪里找到输出文件？

**A**: 
- 训练结果：在配置文件中指定的 `results_path`
- 推理结果：在推理时指定的输出文件夹
- 验证结果：显示在验证界面，也可以保存到文件

### Q6: 程序支持哪些音频格式？

**A**: 支持常见音频格式：
- WAV (.wav)
- MP3 (.mp3)
- FLAC (.flac)
- OGG (.ogg)
- 其他 Python 音频库支持的格式

### Q7: 如何使用多个 GPU 进行训练？

**A**: 在配置文件中设置 `device_ids` 参数，例如：
```yaml
device_ids: [0, 1, 2]  # 使用 GPU 0, 1, 2
```

### Q8: 训练中断后如何恢复？

**A**: 
1. 在配置文件中指定 `start_check_point` 参数
2. 程序会从检查点继续训练
3. 检查点文件通常在 `results_path/checkpoints/` 目录

### Q9: 程序运行时可以做什么？

**A**: 
- 训练时：可以查看实时进度和指标
- 推理时：可以查看处理进度
- 验证时：可以查看指标计算进度
- 所有操作都可以按 **Esc** 中断

### Q10: 如何报告问题或获取帮助？

**A**: 
- 查看项目 README.md 文件
- 查看项目文档目录
- 联系技术支持（如果有）

---

## 使用技巧

### 技巧 1：快速导航

- 使用方向键快速浏览列表
- 记住常用模型的位置，可以快速选择

### 技巧 2：配置管理

- 为不同的任务创建不同的配置文件
- 使用描述性的配置文件名（如 `config_vocal.yaml`、`config_drum.yaml`）

### 技巧 3：训练监控

- 定期检查训练进度
- 注意损失曲线是否收敛
- 监控 GPU 使用情况

### 技巧 4：批量推理

- 将所有要处理的音频文件放在一个文件夹
- 使用批量推理功能一次性处理

---

## 系统要求

### 最低配置

- **操作系统**: Windows 10/11, Linux, macOS
- **内存**: 4GB RAM
- **存储**: 10GB 可用空间
- **Python**: 3.8 或更高版本（已包含在程序中）

### 推荐配置

- **操作系统**: Windows 11, Ubuntu 20.04+, macOS 12+
- **内存**: 16GB RAM 或更多
- **存储**: 50GB SSD 可用空间
- **GPU**: NVIDIA GPU（CUDA 11.0+）
- **显存**: 8GB 或更多

---

## 更新日志

### v1.0.0 (2025-12-27)

**新增功能**:
- ✅ 模型选择（16 种模型）
- ✅ 光标高亮显示
- ✅ 帮助系统
- ✅ 键盘导航

**修复问题**:
- ✅ 修复方向键跳两个项目的问题
- ✅ 修复帮助界面闪烁的问题
- ✅ 修复 ESC 键导致程序崩溃的问题
- ✅ 改进程序启动时的目录检测

**待开发功能**:
- ⏳ 配置管理界面
- ⏳ 训练进度监控
- ⏳ 推理批量处理
- ⏳ 验证指标可视化

---

## 联系与支持

如果你遇到问题或有建议，请：

1. 查看本手册的"常见问题"部分
2. 查看项目文档（`docs/` 目录）
3. 查看 GitHub Issues（如果有）

---

## 版权声明

本程序是音乐分离训练项目的一部分。详细信息请参考主项目许可证。

---

**祝你使用愉快！** 🎵
